<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Test</title>
    </head>
    <body>
        <script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/moment-duration-format/2.3.2/moment-duration-format.min.js"></script>
        <script src='//api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
        <link href='//api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' property='stylesheet'/>
        <script type="text/javascript">

            L.mapbox.accessToken = "pk.eyJ1IjoidGhlZmxvb3ciLCJhIjoiaGFWLVhLRSJ9.X1fJCnMuqwE9wzFiitHiUw";

            let map = L.mapbox.map("map", null, {
                        worldCopyJump: !0,
                        maxBounds: [
                            [-90, -180],
                            [90, 180]
                        ],
                        tileLayer: {
                            continuousWorld: !1,
                            noWrap: !0
                        },
                        zoomControl: false,
                        attributionControl: false
                    })
                    .setView([38.20365531807149, -97.6025390625], 5)
                    .addLayer(L.mapbox.styleLayer('mapbox://styles/mapbox/streets-v11'));

            let journeyInterval = null,
                isPaused = false;

            const Journey = {}

            Journey.journeyParts = [];

            navigator.geolocation.getCurrentPosition(function(position){
                //
            });

            function addJourneyPart() {

                let journeyPart = {};
                journeyPart.dateTime = new Date();

                navigator.geolocation.getCurrentPosition(function(position){
                    journeyPart.latitude = position.coords.latitude;
                    journeyPart.longitude = position.coords.longitude;

                    Journey.journeyParts.push(journeyPart);

                    $('#journeyParts').append("<li><b>" + journeyPart.dateTime + "</b> " + journeyPart.latitude + ", " + journeyPart.longitude + "</li>");
                });
            }

            function startJourney() {
                Journey.startTime = new Date();
                $('#startTime').html(Journey.startTime);
                isRecording = true;
                journeyInterval = setInterval(function(){
                    if(isPaused) return;
                        addJourneyPart();
                        updateTimer();
                }, 1);
            }

            function updateTimer() {
                let endTime = new Date();
                let startTime = Journey.startTime;
                // using the main startTime means pause will jump!
                // Journey.journeyParts[Journey.journeyParts.length-1].dateTime
                let diff = moment.duration(moment(endTime).diff(starTime));
                $('#timer').html([diff.hours(), diff.minutes(), diff.seconds(), diff.milliseconds()].join(':'))
            }

            function stopJourney() {
                clearInterval(journeyInterval);
                Journey.endTime = new Date();
                $('#endTime').html(Journey.endTime);

                L.polyline(getLatLng(Journey.journeyParts), {
                    color: 'black',
                    opacity: 1
                }).addTo(map);
            }

            function pauseJourney() {
                isPaused = true;
            }

            function continueJourney() {
                isPaused = false;
            }

            $(document).on('click', '#start', function(e) {
                e.preventDefault();
                $('#start').hide();
                $('#stop, #pause').show();
                startJourney();
            });

            $(document).on('click', '#stop', function(e) {
                e.preventDefault();
                $('#start, #stop, #pause, #continue').hide();
                stopJourney();
            });

            $(document).on('click', '#pause', function(e) {
                e.preventDefault();
                pauseJourney();
                $('#pause').hide();
                $('#continue').show();
            });

            $(document).on('click', '#continue', function(e) {
                e.preventDefault();
                continueJourney();
                $('#pause').show();
                $('#continue').hide();
            });

            function getLatLng(t) {
                for (var e = [], n = 0; n < t.length; n++) e.push([t[n].latitude, t[n].longitude]);
                return e;
            }

        </script>

        <button id="start">Start</button>
        <button id="pause" style="display: none;">Pause</button>
        <button id="continue" style="display: none;">Continue</button>
        <button id="stop" style="display: none;">Stop</button>

        <div id="timer"></div>

        <p>Start Time: <span id="startTime"></span></p>
        <p>End Time: <span id="endTime"></span></p>

        <ul id="journeyParts"></ul>

        <div id="map" style="width:100%;height:640px;"></div>
    </body>
</html>